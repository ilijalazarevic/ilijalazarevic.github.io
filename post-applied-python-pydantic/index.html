<!DOCTYPE html> <html lang="en-US"> <head prefix="og: http://ogp.me/ns#"> <meta charset="UTF-8" /> <meta http-equiv="X-UA-Compatible" content="ie=edge" /> <meta name="viewport" content="width=device-width, initial-scale=1.0" /> <meta name="mobile-web-app-capable" content="yes" /> <meta name="apple-mobile-web-app-capable" content="yes" /> <meta name="application-name" content="Ilija Lazarevic" /> <meta name="apple-mobile-web-app-status-bar-style" content="#fff" /> <meta name="apple-mobile-web-app-title" content="Ilija Lazarevic" /> <title> Applied Python: Pydantic - Ilija Lazarevic </title> <link rel="alternate" href="http://localhost:4000/post-applied-python-pydantic/" hreflang="en-US" /> <link rel="canonical" href="http://localhost:4000/post-applied-python-pydantic/" /> <meta name="description" content="Working with data almost always starts with data clearning, parsing, and validating. Pydantic is a Python library that sets standards for how it should be done." /> <meta name="referrer" content="no-referrer-when-downgrade" /> <meta property="fb:app_id" content="" /> <meta property="og:site_name" content="Applied Python: Pydantic | Ilija Lazarevic" /> <meta property="og:title" content="Applied Python: Pydantic | Ilija Lazarevic" /> <meta property="og:type" content="website" /> <meta property="og:url" content="http://localhost:4000/post-applied-python-pydantic/" /> <meta property="og:description" content="Working with data almost always starts with data clearning, parsing, and validating. Pydantic is a Python library that sets standards for how it should be done." /> <meta property="og:image" content="http://localhost:4000/assets/img/centaur.jpg" /> <meta property="og:image:width" content="640" /> <meta property="og:image:height" content="640" /> <meta name="twitter:card" content="summary" /> <meta name="twitter:title" content="Applied Python: Pydantic | " /> <meta name="twitter:url" content="http://localhost:4000/post-applied-python-pydantic/" /> <meta name="twitter:site" content="@" /> <meta name="twitter:creator" content="@" /> <meta name="twitter:description" content="Working with data almost always starts with data clearning, parsing, and validating. Pydantic is a Python library that sets standards for how it should be done." /> <meta name="twitter:image" content="http://localhost:4000/assets/img/centaur.jpg" /> <link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="Ilija Lazarevic" /> <link rel="apple-touch-icon" sizes="180x180" href="/assets/favicons/apple-touch-icon.png" /> <link rel="icon" type="image/png" sizes="32x32" href="/assets/favicons/favicon-32x32.png" /> <link rel="icon" type="image/png" sizes="16x16" href="/assets/favicons/favicon-16x16.png" /> <link rel="manifest" href="/assets/favicons/site.webmanifest" /> <link rel="mask-icon" href="/assets/favicons/safari-pinned-tab.svg" color="#5bbad5" /> <meta name="apple-mobile-web-app-title" content="Jekyll Klise" /> <meta name="application-name" content="Jekyll Klise" /> <meta name="msapplication-TileColor" content="#da532c" /> <meta name="theme-color" content="#2c2c2c" /> <link rel="stylesheet" href="/assets/css/style.css" /> <!-- for mathjax support --> </head> <body data-theme="dark" class="notransition"> <script> const body = document.body; const data = body.getAttribute("data-theme"); const initTheme = (state) => { if (state === "dark") { body.setAttribute("data-theme", "dark"); } else if (state === "light") { body.removeAttribute("data-theme"); } else { localStorage.setItem("theme", data); } }; initTheme(localStorage.getItem("theme")); setTimeout(() => body.classList.remove("notransition"), 75); </script> <div class="navbar" role="navigation"> <nav class="menu"> <input type="checkbox" id="menu-trigger" class="menu-trigger" /> <label for="menu-trigger"> <span class="menu-icon"> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 512 512" > <path d="M64,384H448V341.33H64Zm0-106.67H448V234.67H64ZM64,128v42.67H448V128Z" /> </svg> </span> </label> <a id="mode"> <svg class="mode-sunny" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 512 512" > <title>LIGHT</title> <line x1="256" y1="48" x2="256" y2="96" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="256" y1="416" x2="256" y2="464" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="403.08" y1="108.92" x2="369.14" y2="142.86" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="142.86" y1="369.14" x2="108.92" y2="403.08" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="464" y1="256" x2="416" y2="256" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="96" y1="256" x2="48" y2="256" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="403.08" y1="403.08" x2="369.14" y2="369.14" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="142.86" y1="142.86" x2="108.92" y2="108.92" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <circle cx="256" cy="256" r="80" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> </svg> <svg class="mode-moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 512 512" > <title>DARK</title> <line x1="256" y1="48" x2="256" y2="96" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="256" y1="416" x2="256" y2="464" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="403.08" y1="108.92" x2="369.14" y2="142.86" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="142.86" y1="369.14" x2="108.92" y2="403.08" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="464" y1="256" x2="416" y2="256" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="96" y1="256" x2="48" y2="256" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="403.08" y1="403.08" x2="369.14" y2="369.14" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="142.86" y1="142.86" x2="108.92" y2="108.92" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <circle cx="256" cy="256" r="80" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> </svg> </a> <div class="trigger"> <div class="trigger-container"><a class="menu-link" href="/">home</a><a class="menu-link" href="/archive/">archive</a><a class="menu-link" href="/about/">about</a><a class="menu-link rss" href="/feed.xml"> <svg xmlns="http://www.w3.org/2000/svg" width="17" height="17" viewBox="0 0 512 512" fill="#ED812E" > <title>RSS</title> <path d="M108.56,342.78a60.34,60.34,0,1,0,60.56,60.44A60.63,60.63,0,0,0,108.56,342.78Z" /> <path d="M48,186.67v86.55c52,0,101.94,15.39,138.67,52.11s52,86.56,52,138.67h86.66C325.33,312.44,199.67,186.67,48,186.67Z" /> <path d="M48,48v86.56c185.25,0,329.22,144.08,329.22,329.44H464C464,234.66,277.67,48,48,48Z" /> </svg> </a> </div> </div> </nav> </div> <div class="wrapper post"> <main class="page-content" aria-label="Content"> <article itemscope itemtype="https://schema.org/BlogPosting"> <header class="header"> <div class="tags"> <span itemprop="keywords"> <a class="tag" href="/tags/#python">PYTHON</a>, <a class="tag" href="/tags/#pydantic">PYDANTIC</a>, <a class="tag" href="/tags/#big-data">BIG DATA</a>, <a class="tag" href="/tags/#processing">PROCESSING</a>, <a class="tag" href="/tags/#llm">LLM</a> </span> </div> <h1 class="header-title" itemprop="headline">Applied Python: Pydantic</h1> <div class="post-meta"> <time datetime="2024-07-24T07:14:21+02:00" itemprop="datePublished"> Jul 24, 2024 </time> <span itemprop="author" itemscope itemtype="https://schema.org/Person"> <span itemprop="name">Ilija Lazarevic</span> </span> <time hidden datetime="2024-07-24T07:14:21+02:00" itemprop="dateModified"> Jul 24, 2024 </time> <span hidden itemprop="publisher" itemtype="Person">Ilija Lazarevic</span> <span hidden itemprop="image">../assets/img/centaur.jpg</span> <span hidden itemprop="mainEntityOfPage"><p>There are quite a few use cases where Pydantic fits almost seamlessly. Data processing, among others, benefits from using Pydantic as well. However, it can be used in web development for parsing and structuring data in expected formats.</p> </span> </div> </header> <div class="page-content" itemprop="articleBody"> <p>There are quite a few use cases where Pydantic fits almost seamlessly. Data processing, among others, benefits from using Pydantic as well. However, it can be used in web development for parsing and structuring data in expected formats.</p> <p>Today’s idea is to define a couple of pain points and show how Pydantic can be used.</p> <p>Let’s start with the most familiar use case, and that is data parsing and processing.</p> <p>Let’s say we have a CSV file with a dozen  columns and thousands of rows. The usual scenario in data analysis is to load this CSV into Pandas DataFrame and start fiddling with it. Often you start inspecting the data and types of columns, drop some of them, and create new ones. This process is based on your previous knowledge of what is in the dataset. Yet, this is not always transparent to the others. They either have to go and open a CSV file (or any other source of data) or skim through the code to figure out what columns are being used and created. This is all good for the initial steps of data analysis and research. However, once the data set is analyzed and we are ready to go into creating a data pipeline that will load, transform, and use data for analytics or machine learning purposes, we need a standardized way of making sure datasets and data types are in expected format. This is why we want a library that will give us the ability to declare or define this. There are few libraries for this, but Pydantic found its way in different frameworks and is universally accepted in different use cases.</p> <p>Okay, let’s start.</p> <h1 id="python---type-hinting"> <a href="#python---type-hinting" class="anchor-head"></a> Python - Type hinting </h1> <p>Before we get into the example I have previously mentioned, I’d like to start with some basics in Python.</p> <p>Through its versions, Python introduced type hinting. What is type hinting, and why do we need it? Well, as we all know, Python is a dynamically typed scripting language. This means that data types are inferred in runtime. This has its benefits in engineers being able to write code faster. The bad part is that you will not be alarmed about type mismatches until you run your code. At that time, it may be a bit late to fix your error quickly. Because Python still remains a dynamically typed language, there was an intent to bridge this gap by introducing so-called “type hinting” that engineers can use to notify both readers and IDEs about expected data types.</p> <p>Example:</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span>
	
<span class="n">add</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="n">add</span><span class="p">(.</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
<span class="n">add</span><span class="p">(</span><span class="s">'a'</span><span class="p">,</span> <span class="s">'b'</span><span class="p">)</span>
</code></pre></div></div> <p>This is a short example of how a defined function may be used in multiple use cases, some of which were not envisioned by its writer. For someone persistent enough, you will have to introduce many hoops so you can be assured your code is used in the intended way.</p> <p>How does type hinting look?</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="n">a</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span>

<span class="n">add</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="n">add</span><span class="p">(.</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
<span class="n">add</span><span class="p">(</span><span class="s">'a'</span><span class="p">,</span> <span class="s">'b'</span><span class="p">)</span>
</code></pre></div></div> <p>This one works as well! Why? Well, this is still called “type hinting,” not “type enforcing”. As already mentioned, it is used as a way to “notify” readers and “users” about the intended way of use. One of the code “users” are IDEs, and your IDE of choice should be able to figure out and raise alerts in case you try to bypass the data type declarations.</p> <p>Why did we go to describe something like this? Well, it is because Pydantic is built on top of this type of hinting. It uses type hinting to define data types and structures and validate them as well.</p> <h1 id="pydantic---first-steps"> <a href="#pydantic---first-steps" class="anchor-head"></a> Pydantic - First steps </h1> <p>As I already mentioned, Pydantic is used to validate data structures and data types. There are four ways in which you can use it. Today I will go through the two most important:</p> <ul> <li><code class="language-plaintext highlighter-rouge">validate_call</code> to validate function calls based on type hinting and annotations,</li> <li><code class="language-plaintext highlighter-rouge">BaseModel</code> to define and validate models through class definitions.</li> </ul> <h2 id="pydantic---validate_call"> <a href="#pydantic---validate_call" class="anchor-head"></a> Pydantic - validate_call </h2> <p>So, there is no better way to start with something new than to immerse yourself right away. This is how we shall start learning Pydantic.</p> <p>Before you are able to use it, you have to install it:</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pip <span class="nb">install </span>pydantic
</code></pre></div></div> <p>For the sake of clarity, let me note both Python and pydantic versions here as well:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>python version: 3.10.5
pydantic version: 2.5.3
</code></pre></div></div> <p>Then, you want to create a new Python project, create your first Python script, import Pydantic, and start using it. The first example will be to revise our previous function and use Pydantic to make sure it is used in the intended way. Example:</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">pydantic</span>

<span class="o">@</span><span class="n">pydantic</span><span class="p">.</span><span class="n">validate_call</span>
<span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="n">a</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span>

<span class="o">----</span>

<span class="n">add</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
<span class="o">&gt;</span> <span class="mi">8</span>

<span class="c1"># ----
</span>
<span class="n">add</span><span class="p">(</span><span class="s">'a'</span><span class="p">,</span> <span class="s">'a'</span><span class="p">)</span>

<span class="o">&gt;</span> <span class="n">ValidationError</span><span class="p">:</span> <span class="mi">2</span> <span class="n">validation</span> <span class="n">errors</span> <span class="k">for</span> <span class="n">add</span>
<span class="mi">0</span>
  <span class="n">Input</span> <span class="n">should</span> <span class="n">be</span> <span class="n">a</span> <span class="n">valid</span> <span class="n">integer</span><span class="p">,</span> <span class="n">unable</span> <span class="n">to</span> <span class="n">parse</span> <span class="n">string</span> <span class="k">as</span> <span class="n">an</span> <span class="n">integer</span> <span class="p">[</span><span class="nb">type</span><span class="o">=</span><span class="n">int_parsing</span><span class="p">,</span> <span class="n">input_value</span><span class="o">=</span><span class="s">'a'</span><span class="p">,</span> <span class="n">input_type</span><span class="o">=</span><span class="nb">str</span><span class="p">]</span>
    <span class="n">For</span> <span class="n">further</span> <span class="n">information</span> <span class="n">visit</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">errors</span><span class="p">.</span><span class="n">pydantic</span><span class="p">.</span><span class="n">dev</span><span class="o">/</span><span class="mf">2.5</span><span class="o">/</span><span class="n">v</span><span class="o">/</span><span class="n">int_parsing</span>
<span class="mi">1</span>
  <span class="n">Input</span> <span class="n">should</span> <span class="n">be</span> <span class="n">a</span> <span class="n">valid</span> <span class="n">integer</span><span class="p">,</span> <span class="n">unable</span> <span class="n">to</span> <span class="n">parse</span> <span class="n">string</span> <span class="k">as</span> <span class="n">an</span> <span class="n">integer</span> <span class="p">[</span><span class="nb">type</span><span class="o">=</span><span class="n">int_parsing</span><span class="p">,</span> <span class="n">input_value</span><span class="o">=</span><span class="s">'a'</span><span class="p">,</span> <span class="n">input_type</span><span class="o">=</span><span class="nb">str</span><span class="p">]</span>
    <span class="n">For</span> <span class="n">further</span> <span class="n">information</span> <span class="n">visit</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">errors</span><span class="p">.</span><span class="n">pydantic</span><span class="p">.</span><span class="n">dev</span><span class="o">/</span><span class="mf">2.5</span><span class="o">/</span><span class="n">v</span><span class="o">/</span><span class="n">int_parsing</span>

<span class="c1"># ----
</span>
<span class="n">add</span><span class="p">(.</span><span class="mi">4</span><span class="p">,</span> <span class="p">.</span><span class="mi">3</span><span class="p">)</span>

<span class="o">&gt;</span> <span class="n">ValidationError</span><span class="p">:</span> <span class="mi">2</span> <span class="n">validation</span> <span class="n">errors</span> <span class="k">for</span> <span class="n">add</span>
<span class="mi">0</span>
  <span class="n">Input</span> <span class="n">should</span> <span class="n">be</span> <span class="n">a</span> <span class="n">valid</span> <span class="n">integer</span><span class="p">,</span> <span class="n">got</span> <span class="n">a</span> <span class="n">number</span> <span class="k">with</span> <span class="n">a</span> <span class="n">fractional</span> <span class="n">part</span> <span class="p">[</span><span class="nb">type</span><span class="o">=</span><span class="n">int_from_float</span><span class="p">,</span> <span class="n">input_value</span><span class="o">=</span><span class="mf">0.4</span><span class="p">,</span> <span class="n">input_type</span><span class="o">=</span><span class="nb">float</span><span class="p">]</span>
    <span class="n">For</span> <span class="n">further</span> <span class="n">information</span> <span class="n">visit</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">errors</span><span class="p">.</span><span class="n">pydantic</span><span class="p">.</span><span class="n">dev</span><span class="o">/</span><span class="mf">2.5</span><span class="o">/</span><span class="n">v</span><span class="o">/</span><span class="n">int_from_float</span>
<span class="mi">1</span>
  <span class="n">Input</span> <span class="n">should</span> <span class="n">be</span> <span class="n">a</span> <span class="n">valid</span> <span class="n">integer</span><span class="p">,</span> <span class="n">got</span> <span class="n">a</span> <span class="n">number</span> <span class="k">with</span> <span class="n">a</span> <span class="n">fractional</span> <span class="n">part</span> <span class="p">[</span><span class="nb">type</span><span class="o">=</span><span class="n">int_from_float</span><span class="p">,</span> <span class="n">input_value</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">input_type</span><span class="o">=</span><span class="nb">float</span><span class="p">]</span>
    <span class="n">For</span> <span class="n">further</span> <span class="n">information</span> <span class="n">visit</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">errors</span><span class="p">.</span><span class="n">pydantic</span><span class="p">.</span><span class="n">dev</span><span class="o">/</span><span class="mf">2.5</span><span class="o">/</span><span class="n">v</span><span class="o">/</span><span class="n">int_from_float</span>

<span class="c1"># ----
</span>
<span class="n">add</span><span class="p">(</span><span class="s">'3'</span><span class="p">,</span> <span class="s">'a'</span><span class="p">)</span>
<span class="o">&gt;</span> <span class="n">ValidationError</span><span class="p">:</span> <span class="mi">1</span> <span class="n">validation</span> <span class="n">error</span> <span class="k">for</span> <span class="n">add</span>
<span class="mi">1</span>
  <span class="n">Input</span> <span class="n">should</span> <span class="n">be</span> <span class="n">a</span> <span class="n">valid</span> <span class="n">integer</span><span class="p">,</span> <span class="n">unable</span> <span class="n">to</span> <span class="n">parse</span> <span class="n">string</span> <span class="k">as</span> <span class="n">an</span> <span class="n">integer</span> <span class="p">[</span><span class="nb">type</span><span class="o">=</span><span class="n">int_parsing</span><span class="p">,</span> <span class="n">input_value</span><span class="o">=</span><span class="s">'a'</span><span class="p">,</span> <span class="n">input_type</span><span class="o">=</span><span class="nb">str</span><span class="p">]</span>
    <span class="n">For</span> <span class="n">further</span> <span class="n">information</span> <span class="n">visit</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">errors</span><span class="p">.</span><span class="n">pydantic</span><span class="p">.</span><span class="n">dev</span><span class="o">/</span><span class="mf">2.5</span><span class="o">/</span><span class="n">v</span><span class="o">/</span><span class="n">int_parsing</span>

<span class="o">----</span>
    
<span class="n">add</span><span class="p">(</span><span class="s">'3'</span><span class="p">,</span> <span class="s">'3'</span><span class="p">)</span>
<span class="o">&gt;</span> <span class="mi">6</span>

<span class="c1"># ----
</span>
<span class="n">add</span><span class="p">(</span><span class="s">'3'</span><span class="p">,</span> <span class="s">'3.3'</span><span class="p">)</span>

<span class="o">&gt;</span> <span class="n">ValidationError</span><span class="p">:</span> <span class="mi">1</span> <span class="n">validation</span> <span class="n">error</span> <span class="k">for</span> <span class="n">add</span>
<span class="mi">1</span>
  <span class="n">Input</span> <span class="n">should</span> <span class="n">be</span> <span class="n">a</span> <span class="n">valid</span> <span class="n">integer</span><span class="p">,</span> <span class="n">unable</span> <span class="n">to</span> <span class="n">parse</span> <span class="n">string</span> <span class="k">as</span> <span class="n">an</span> <span class="n">integer</span> <span class="p">[</span><span class="nb">type</span><span class="o">=</span><span class="n">int_parsing</span><span class="p">,</span> <span class="n">input_value</span><span class="o">=</span><span class="s">'3.3'</span><span class="p">,</span> <span class="n">input_type</span><span class="o">=</span><span class="nb">str</span><span class="p">]</span>
    <span class="n">For</span> <span class="n">further</span> <span class="n">information</span> <span class="n">visit</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">errors</span><span class="p">.</span><span class="n">pydantic</span><span class="p">.</span><span class="n">dev</span><span class="o">/</span><span class="mf">2.5</span><span class="o">/</span><span class="n">v</span><span class="o">/</span><span class="n">int_parsing</span>

</code></pre></div></div> <p>A couple of things to clarify:</p> <ul> <li><code class="language-plaintext highlighter-rouge">validate_call</code> is used as a decorator. This is basically a wrapper around the function declared that introduces additional logic that can be run at the time the function is defined as well as when you call the function. Here, it is used to make sure the data you pass to the function call conforms to the expected data types (hints).</li> <li>A validated function call raises <code class="language-plaintext highlighter-rouge">ValidationError</code> in a case you start using your function in an unintended way. This error is verbose and says a lot about why it was raised.</li> <li>By principle of charity, Pydantic tries to figure out what you meant and tries to use type coercion. This can result in string values passed to a function call being implicitly converted to the expected type.</li> <li>Type coercion is not always possible, and in that case, <code class="language-plaintext highlighter-rouge">ValidationError</code> is raised.</li> </ul> <p>What about default values and argument extractions?</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">pydantic</span> <span class="kn">import</span> <span class="n">validate_call</span>

<span class="o">@</span><span class="n">validate_call</span><span class="p">(</span><span class="n">validate_return</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">a</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">4</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
    <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">+</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span><span class="p">)</span>

<span class="c1"># ----
</span>
<span class="n">add</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span>

<span class="o">&gt;</span> <span class="n">ValidationError</span><span class="p">:</span> <span class="mi">1</span> <span class="n">validation</span> <span class="n">error</span> <span class="k">for</span> <span class="n">add</span>
<span class="n">a</span>
  <span class="n">Missing</span> <span class="n">required</span> <span class="n">keyword</span> <span class="n">only</span> <span class="n">argument</span> <span class="p">[</span><span class="nb">type</span><span class="o">=</span><span class="n">missing_keyword_only_argument</span><span class="p">,</span> <span class="n">input_value</span><span class="o">=</span><span class="n">ArgsKwargs</span><span class="p">((</span><span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">)),</span> <span class="n">input_type</span><span class="o">=</span><span class="n">ArgsKwargs</span><span class="p">]</span>
    <span class="n">For</span> <span class="n">further</span> <span class="n">information</span> <span class="n">visit</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">errors</span><span class="p">.</span><span class="n">pydantic</span><span class="p">.</span><span class="n">dev</span><span class="o">/</span><span class="mf">2.5</span><span class="o">/</span><span class="n">v</span><span class="o">/</span><span class="n">missing_keyword_only_argument</span>

<span class="c1"># ----
</span>
<span class="n">add</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">a</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>

<span class="o">&gt;</span> <span class="mi">18</span>

<span class="c1"># ----
</span>
<span class="o">@</span><span class="n">validate_call</span>
<span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">a</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">4</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
    <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">+</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span><span class="p">)</span>

<span class="c1"># ---- 
</span>
<span class="n">add</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">a</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>

<span class="o">&gt;</span> <span class="s">'18'</span>
</code></pre></div></div> <p>Takeaways from this example:</p> <ul> <li>You can annotate the type of the variable number of arguments declaration (*args).</li> <li>Default values are still an option, even if you are annotating variable data types.</li> <li><code class="language-plaintext highlighter-rouge">validate_call</code> accepts <code class="language-plaintext highlighter-rouge">validate_return</code> argument, which makes function return value validation as well. Data type coercion is also applied in this case. <code class="language-plaintext highlighter-rouge">validate_return</code> is set to <code class="language-plaintext highlighter-rouge">False</code> by default. If it is left as it is, the function may not return what is declared in type hinting.</li> </ul> <p>What about if you want to validate the data type but also constrain the values that variable can take? Example:</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">pydantic</span> <span class="kn">import</span> <span class="n">validate_call</span><span class="p">,</span> <span class="n">Field</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Annotated</span> 

<span class="n">type_age</span> <span class="o">=</span> <span class="n">Annotated</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Field</span><span class="p">(</span><span class="n">lt</span><span class="o">=</span><span class="mi">120</span><span class="p">)]</span>

<span class="o">@</span><span class="n">validate_call</span><span class="p">(</span><span class="n">validate_return</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="n">age_one</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">age_two</span><span class="p">:</span> <span class="n">type_age</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">age_one</span> <span class="o">+</span> <span class="n">age_two</span>

<span class="n">add</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">300</span><span class="p">)</span>

<span class="o">&gt;</span> <span class="n">ValidationError</span><span class="p">:</span> <span class="mi">1</span> <span class="n">validation</span> <span class="n">error</span> <span class="k">for</span> <span class="n">add</span>
<span class="mi">1</span>
  <span class="n">Input</span> <span class="n">should</span> <span class="n">be</span> <span class="n">less</span> <span class="n">than</span> <span class="mi">120</span> <span class="p">[</span><span class="nb">type</span><span class="o">=</span><span class="n">less_than</span><span class="p">,</span> <span class="n">input_value</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">input_type</span><span class="o">=</span><span class="nb">int</span><span class="p">]</span>
    <span class="n">For</span> <span class="n">further</span> <span class="n">information</span> <span class="n">visit</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">errors</span><span class="p">.</span><span class="n">pydantic</span><span class="p">.</span><span class="n">dev</span><span class="o">/</span><span class="mf">2.5</span><span class="o">/</span><span class="n">v</span><span class="o">/</span><span class="n">less_than</span>

</code></pre></div></div> <p>This example shows:</p> <ul> <li>You can use <code class="language-plaintext highlighter-rouge">Annotated</code> and <code class="language-plaintext highlighter-rouge">pydantic.Field</code> to not only validate data type but also add metadata that Pydantic uses to constrain variable values and formats.</li> <li><code class="language-plaintext highlighter-rouge">ValidationError</code> is yet again very verbose about what was wrong with our function call. This can be really helpful.</li> </ul> <p>Here is one more example of how you can both validate and constrain variable values. We will simulate a payload (dictionary) that you want to process in your function after it has been validated:</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">pydantic</span> <span class="kn">import</span> <span class="n">HttpUrl</span><span class="p">,</span> <span class="n">PastDate</span>
<span class="kn">from</span> <span class="nn">pydantic</span> <span class="kn">import</span> <span class="n">Field</span>
<span class="kn">from</span> <span class="nn">pydantic</span> <span class="kn">import</span> <span class="n">validate_call</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Annotated</span>

<span class="n">Name</span> <span class="o">=</span> <span class="n">Annotated</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Field</span><span class="p">(</span><span class="n">min_length</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">max_length</span><span class="o">=</span><span class="mi">15</span><span class="p">)]</span>

<span class="o">@</span><span class="n">validate_call</span><span class="p">(</span><span class="n">validate_return</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">process_payload</span><span class="p">(</span><span class="n">url</span><span class="p">:</span> <span class="n">HttpUrl</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="n">Name</span><span class="p">,</span> <span class="n">birth_date</span><span class="p">:</span> <span class="n">PastDate</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="k">return</span> <span class="sa">f</span><span class="s">'</span><span class="si">{</span><span class="n">name</span><span class="o">=</span><span class="si">}</span><span class="s">, </span><span class="si">{</span><span class="n">birth_date</span><span class="o">=</span><span class="si">}</span><span class="s">'</span>

<span class="c1"># ----
</span>
<span class="n">payload</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">'url'</span><span class="p">:</span> <span class="s">'httpss://example.com'</span><span class="p">,</span>
    <span class="s">'name'</span><span class="p">:</span> <span class="s">'J'</span><span class="p">,</span>
    <span class="s">'birth_date'</span><span class="p">:</span> <span class="s">'2024-12-12'</span>
<span class="p">}</span>

<span class="n">process_payload</span><span class="p">(</span><span class="o">**</span><span class="n">payload</span><span class="p">)</span>

<span class="o">&gt;</span> <span class="n">ValidationError</span><span class="p">:</span> <span class="mi">3</span> <span class="n">validation</span> <span class="n">errors</span> <span class="k">for</span> <span class="n">process_payload</span>
<span class="n">url</span>
  <span class="n">URL</span> <span class="n">scheme</span> <span class="n">should</span> <span class="n">be</span> <span class="s">'http'</span> <span class="ow">or</span> <span class="s">'https'</span> <span class="p">[</span><span class="nb">type</span><span class="o">=</span><span class="n">url_scheme</span><span class="p">,</span> <span class="n">input_value</span><span class="o">=</span><span class="s">'httpss://example.com'</span><span class="p">,</span> <span class="n">input_type</span><span class="o">=</span><span class="nb">str</span><span class="p">]</span>
    <span class="n">For</span> <span class="n">further</span> <span class="n">information</span> <span class="n">visit</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">errors</span><span class="p">.</span><span class="n">pydantic</span><span class="p">.</span><span class="n">dev</span><span class="o">/</span><span class="mf">2.5</span><span class="o">/</span><span class="n">v</span><span class="o">/</span><span class="n">url_scheme</span>
<span class="n">name</span>
  <span class="n">String</span> <span class="n">should</span> <span class="n">have</span> <span class="n">at</span> <span class="n">least</span> <span class="mi">2</span> <span class="n">characters</span> <span class="p">[</span><span class="nb">type</span><span class="o">=</span><span class="n">string_too_short</span><span class="p">,</span> <span class="n">input_value</span><span class="o">=</span><span class="s">'J'</span><span class="p">,</span> <span class="n">input_type</span><span class="o">=</span><span class="nb">str</span><span class="p">]</span>
    <span class="n">For</span> <span class="n">further</span> <span class="n">information</span> <span class="n">visit</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">errors</span><span class="p">.</span><span class="n">pydantic</span><span class="p">.</span><span class="n">dev</span><span class="o">/</span><span class="mf">2.5</span><span class="o">/</span><span class="n">v</span><span class="o">/</span><span class="n">string_too_short</span>
<span class="n">birth_date</span>
  <span class="n">Date</span> <span class="n">should</span> <span class="n">be</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">past</span> <span class="p">[</span><span class="nb">type</span><span class="o">=</span><span class="n">date_past</span><span class="p">,</span> <span class="n">input_value</span><span class="o">=</span><span class="s">'2024-12-12'</span><span class="p">,</span> <span class="n">input_type</span><span class="o">=</span><span class="nb">str</span><span class="p">]</span>
    <span class="n">For</span> <span class="n">further</span> <span class="n">information</span> <span class="n">visit</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">errors</span><span class="p">.</span><span class="n">pydantic</span><span class="p">.</span><span class="n">dev</span><span class="o">/</span><span class="mf">2.5</span><span class="o">/</span><span class="n">v</span><span class="o">/</span><span class="n">date_past</span>

<span class="c1"># ----
</span>
<span class="n">payload</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">'url'</span><span class="p">:</span> <span class="s">'https://example.com'</span><span class="p">,</span>
    <span class="s">'name'</span><span class="p">:</span> <span class="s">'Joe-1234567891011121314'</span><span class="p">,</span>
    <span class="s">'birth_date'</span><span class="p">:</span> <span class="s">'2020-12-12'</span>
<span class="p">}</span>

<span class="n">process_payload</span><span class="p">(</span><span class="o">**</span><span class="n">payload</span><span class="p">)</span>

<span class="o">&gt;</span> <span class="n">ValidationError</span><span class="p">:</span> <span class="mi">1</span> <span class="n">validation</span> <span class="n">error</span> <span class="k">for</span> <span class="n">process_payload</span>
<span class="n">name</span>
  <span class="n">String</span> <span class="n">should</span> <span class="n">have</span> <span class="n">at</span> <span class="n">most</span> <span class="mi">15</span> <span class="n">characters</span> <span class="p">[</span><span class="nb">type</span><span class="o">=</span><span class="n">string_too_long</span><span class="p">,</span> <span class="n">input_value</span><span class="o">=</span><span class="s">'Joe-1234567891011121314'</span><span class="p">,</span> <span class="n">input_type</span><span class="o">=</span><span class="nb">str</span><span class="p">]</span>
    <span class="n">For</span> <span class="n">further</span> <span class="n">information</span> <span class="n">visit</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">errors</span><span class="p">.</span><span class="n">pydantic</span><span class="p">.</span><span class="n">dev</span><span class="o">/</span><span class="mf">2.5</span><span class="o">/</span><span class="n">v</span><span class="o">/</span><span class="n">string_too_long</span>

</code></pre></div></div> <p>This was the basics of how to validate function arguments and their return value.</p> <p>Now, we will go to the second most important way Pydantic can be used to validate and process data: through defining models.</p> <h2 id="pydantic---basemodel"> <a href="#pydantic---basemodel" class="anchor-head"></a> Pydantic - BaseModel </h2> <p>This part is more interesting for the purposes of data processing, as you will see.</p> <p>So far, we have used <code class="language-plaintext highlighter-rouge">validate_call</code> to decorate functions and specified function arguments and their corresponding types and constraints.</p> <p>Here, we define models by defining model classes, where we specify fields, their types, and constraints. This is very similar to what we did previously. By defining a model class that inherits from Pydantic <code class="language-plaintext highlighter-rouge">BaseModel</code>, we use a hidden mechanism that does the data validation, parsing, and serialization. What this gives us is the ability to create objects that conform to model specifications.</p> <p>Here is an example:</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">pydantic</span> <span class="kn">import</span> <span class="n">Field</span>
<span class="kn">from</span> <span class="nn">pydantic</span> <span class="kn">import</span> <span class="n">BaseModel</span>

<span class="k">class</span> <span class="nc">Person</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">min_length</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">max_length</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
    <span class="n">age</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">gt</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">lt</span><span class="o">=</span><span class="mi">120</span><span class="p">)</span>

<span class="c1"># ----
</span>	
<span class="n">john</span> <span class="o">=</span> <span class="n">Person</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">'john'</span><span class="p">,</span> <span class="n">age</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>

<span class="o">&gt;</span> <span class="n">Person</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">'john'</span><span class="p">,</span> <span class="n">age</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>

<span class="c1"># ----
</span>
<span class="n">mike</span> <span class="o">=</span> <span class="n">Person</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">'m'</span><span class="p">,</span> <span class="n">age</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="o">&gt;</span> <span class="n">ValidationError</span><span class="p">:</span> <span class="mi">2</span> <span class="n">validation</span> <span class="n">errors</span> <span class="k">for</span> <span class="n">Person</span>
<span class="n">name</span>
  <span class="n">String</span> <span class="n">should</span> <span class="n">have</span> <span class="n">at</span> <span class="n">least</span> <span class="mi">2</span> <span class="n">characters</span> <span class="p">[</span><span class="nb">type</span><span class="o">=</span><span class="n">string_too_short</span><span class="p">,</span> <span class="n">input_value</span><span class="o">=</span><span class="s">'j'</span><span class="p">,</span> <span class="n">input_type</span><span class="o">=</span><span class="nb">str</span><span class="p">]</span>
    <span class="n">For</span> <span class="n">further</span> <span class="n">information</span> <span class="n">visit</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">errors</span><span class="p">.</span><span class="n">pydantic</span><span class="p">.</span><span class="n">dev</span><span class="o">/</span><span class="mf">2.5</span><span class="o">/</span><span class="n">v</span><span class="o">/</span><span class="n">string_too_short</span>
<span class="n">age</span>
  <span class="n">Input</span> <span class="n">should</span> <span class="n">be</span> <span class="n">greater</span> <span class="n">than</span> <span class="mi">0</span> <span class="p">[</span><span class="nb">type</span><span class="o">=</span><span class="n">greater_than</span><span class="p">,</span> <span class="n">input_value</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">input_type</span><span class="o">=</span><span class="nb">int</span><span class="p">]</span>
    <span class="n">For</span> <span class="n">further</span> <span class="n">information</span> <span class="n">visit</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">errors</span><span class="p">.</span><span class="n">pydantic</span><span class="p">.</span><span class="n">dev</span><span class="o">/</span><span class="mf">2.5</span><span class="o">/</span><span class="n">v</span><span class="o">/</span><span class="n">greater_than</span>
</code></pre></div></div> <p>You can use annotation here as well, and you can also specify default values for fields. Let’s see another example:</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">pydantic</span> <span class="kn">import</span> <span class="n">Field</span>
<span class="kn">from</span> <span class="nn">pydantic</span> <span class="kn">import</span> <span class="n">BaseModel</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Annotated</span> 

<span class="n">Name</span> <span class="o">=</span> <span class="n">Annotated</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Field</span><span class="p">(</span><span class="n">min_length</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">max_length</span><span class="o">=</span><span class="mi">15</span><span class="p">)]</span>
<span class="n">Age</span> <span class="o">=</span> <span class="n">Annotated</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">ge</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">le</span><span class="o">=</span><span class="mi">120</span><span class="p">)]</span>

<span class="k">class</span> <span class="nc">Person</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
    <span class="n">name</span><span class="p">:</span> <span class="n">Name</span>
    <span class="n">age</span><span class="p">:</span> <span class="n">Age</span>

<span class="c1"># ----
</span>
<span class="n">mike</span> <span class="o">=</span> <span class="n">Person</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">'mike'</span><span class="p">)</span>
 
<span class="o">&gt;</span> <span class="n">Person</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">'mike'</span><span class="p">,</span> <span class="n">age</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</code></pre></div></div> <p>Things get very interesting when your use case gets a bit complex. Remember the <code class="language-plaintext highlighter-rouge">payload</code> that we defined? I will define another, more complex structure that we will go through and validate. To make it more interesting, let’s create a payload that we will use to query a service that acts as an intermediary between us and LLM providers. Then we will validate it.</p> <p>Here is an example:</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">pydantic</span> <span class="kn">import</span> <span class="n">Field</span>
<span class="kn">from</span> <span class="nn">pydantic</span> <span class="kn">import</span> <span class="n">BaseModel</span>
<span class="kn">from</span> <span class="nn">pydantic</span> <span class="kn">import</span> <span class="n">ConfigDict</span>

<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Literal</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Annotated</span>

<span class="kn">from</span> <span class="nn">enum</span> <span class="kn">import</span> <span class="n">Enum</span>

<span class="n">payload</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">"req_id"</span><span class="p">:</span> <span class="s">"test"</span><span class="p">,</span>
    <span class="s">"text"</span><span class="p">:</span> <span class="s">"This is a sample text."</span><span class="p">,</span>
    <span class="s">"instruction"</span><span class="p">:</span> <span class="s">"embed"</span><span class="p">,</span>
    <span class="s">"llm_provider"</span><span class="p">:</span> <span class="s">"openai"</span><span class="p">,</span>
    <span class="s">"llm_params"</span><span class="p">:</span> <span class="p">{</span>
        <span class="s">"llm_temperature"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="s">"llm_model_name"</span><span class="p">:</span> <span class="s">"gpt4o"</span>
    <span class="p">},</span>
    <span class="s">"misc"</span><span class="p">:</span> <span class="s">"what"</span>
<span class="p">}</span>

<span class="n">ReqID</span> <span class="o">=</span> <span class="n">Annotated</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Field</span><span class="p">(</span><span class="n">min_length</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">max_length</span><span class="o">=</span><span class="mi">15</span><span class="p">)]</span>

<span class="k">class</span> <span class="nc">LLMProviders</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">Enum</span><span class="p">):</span>
    <span class="n">OPENAI</span> <span class="o">=</span> <span class="s">'openai'</span>
    <span class="n">CLAUDE</span> <span class="o">=</span> <span class="s">'claude'</span>

<span class="k">class</span> <span class="nc">LLMParams</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
    <span class="n">temperature</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">validation_alias</span><span class="o">=</span><span class="s">'llm_temperature'</span><span class="p">,</span> <span class="n">ge</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">le</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">llm_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">validation_alias</span><span class="o">=</span><span class="s">'llm_model_name'</span><span class="p">,</span> 
                          <span class="n">serialization_alias</span><span class="o">=</span><span class="s">'model'</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">Payload</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
    <span class="n">req_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">exclude</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">text</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">min_length</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
    <span class="n">instruction</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s">'embed'</span><span class="p">,</span> <span class="s">'chat'</span><span class="p">]</span>
    <span class="n">llm_provider</span><span class="p">:</span> <span class="n">LLMProviders</span>
    <span class="n">llm_params</span><span class="p">:</span> <span class="n">LLMParams</span>
    
    <span class="c1"># model_config = ConfigDict(use_enum_values=True)
</span>	
<span class="c1"># ----
</span>
<span class="n">validated_payload</span> <span class="o">=</span> <span class="n">Payload</span><span class="p">(</span><span class="o">**</span><span class="n">payload</span><span class="p">)</span>
<span class="n">validated_payload</span>

<span class="o">&gt;</span> <span class="n">Payload</span><span class="p">(</span><span class="n">req_id</span><span class="o">=</span><span class="s">'test'</span><span class="p">,</span> 
	        <span class="n">text</span><span class="o">=</span><span class="s">'This is a sample text.'</span><span class="p">,</span> 
          <span class="n">instruction</span><span class="o">=</span><span class="s">'embed'</span><span class="p">,</span> 
          <span class="n">llm_provider</span><span class="o">=&lt;</span><span class="n">LLMProviders</span><span class="p">.</span><span class="n">OPENAI</span><span class="p">:</span> <span class="s">'openai'</span><span class="o">&gt;</span><span class="p">,</span> 
          <span class="n">llm_params</span><span class="o">=</span><span class="n">LLMParams</span><span class="p">(</span><span class="n">temperature</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">llm_name</span><span class="o">=</span><span class="s">'gpt4o'</span><span class="p">))</span>

<span class="c1"># ----          
</span>
<span class="n">validated_payload</span><span class="p">.</span><span class="n">model_dump</span><span class="p">()</span>

<span class="o">&gt;</span> <span class="p">{</span><span class="s">'text'</span><span class="p">:</span> <span class="s">'This is a sample text.'</span><span class="p">,</span>
 <span class="s">'instruction'</span><span class="p">:</span> <span class="s">'embed'</span><span class="p">,</span>
 <span class="s">'llm_provider'</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">LLMProviders</span><span class="p">.</span><span class="n">OPENAI</span><span class="p">:</span> <span class="s">'openai'</span><span class="o">&gt;</span><span class="p">,</span>
 <span class="s">'llm_params'</span><span class="p">:</span> <span class="p">{</span><span class="s">'temperature'</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s">'llm_name'</span><span class="p">:</span> <span class="s">'gpt4o'</span><span class="p">}}</span>

<span class="c1"># ----
</span> 
<span class="n">validated_payload</span><span class="p">.</span><span class="n">model_dump</span><span class="p">(</span><span class="n">by_alias</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

<span class="o">&gt;</span> <span class="p">{</span><span class="s">'text'</span><span class="p">:</span> <span class="s">'This is a sample text.'</span><span class="p">,</span>
 <span class="s">'instruction'</span><span class="p">:</span> <span class="s">'embed'</span><span class="p">,</span>
 <span class="s">'llm_provider'</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">LLMProviders</span><span class="p">.</span><span class="n">OPENAI</span><span class="p">:</span> <span class="s">'openai'</span><span class="o">&gt;</span><span class="p">,</span>
 <span class="s">'llm_params'</span><span class="p">:</span> <span class="p">{</span><span class="s">'temperature'</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s">'model'</span><span class="p">:</span> <span class="s">'gpt4o'</span><span class="p">}}</span>

<span class="c1"># ----
</span> 
<span class="c1"># After adding 
#	    model_config = ConfigDict(use_enum_values=True)
# in Payload model definition, you get
</span>
<span class="n">validated_payload</span><span class="p">.</span><span class="n">model_dump</span><span class="p">(</span><span class="n">by_alias</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

<span class="o">&gt;</span> <span class="p">{</span><span class="s">'text'</span><span class="p">:</span> <span class="s">'This is a sample text.'</span><span class="p">,</span>
 <span class="s">'instruction'</span><span class="p">:</span> <span class="s">'embed'</span><span class="p">,</span>
 <span class="s">'llm_provider'</span><span class="p">:</span> <span class="s">'openai'</span><span class="p">,</span>
 <span class="s">'llm_params'</span><span class="p">:</span> <span class="p">{</span><span class="s">'temperature'</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s">'model'</span><span class="p">:</span> <span class="s">'gpt4o'</span><span class="p">}}</span>

</code></pre></div></div> <p>Some of the important insights from this elaborated example are:</p> <ul> <li>You can use Enums or <code class="language-plaintext highlighter-rouge">Literal</code> to define a list of specific values that are expected.</li> <li>In case you want to name a model’s field differently from the field name in the validated data, you can use <code class="language-plaintext highlighter-rouge">validation_alias</code>. It specifies the field name in the data being validated.</li> <li><code class="language-plaintext highlighter-rouge">serialization_alias</code> is used when the model’s internal field name is not necessarily the same name you want to use when you serialize the model.</li> <li>Field can be excluded from serialization with <code class="language-plaintext highlighter-rouge">exclude=True</code>.</li> <li>Model fields can be Pydantic models as well. The process of validation in that case is done recursively. This part is really awesome, since Pydantic does the job of going into depth while validating nested structures.</li> <li>Fields that are not taken into account in the model definition are not parsed.</li> </ul> <h2 id="pydantic---use-cases"> <a href="#pydantic---use-cases" class="anchor-head"></a> Pydantic - Use cases </h2> <p>Here I will show you the snippets of code that show where and how you can use Pydantic in your day-to-day tasks.</p> <h3 id="data-processing"> <a href="#data-processing" class="anchor-head"></a> Data processing </h3> <p>Say you have data you need to validate and process. It can be stored in CSV, Parquet files, or, for example, in a NoSQL database in the form of a document. Let’s take the example of a CSV file, and let’s say you want to process its content.</p> <p>Here is the CSV file (<code class="language-plaintext highlighter-rouge">test.csv</code>) example:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>name,age,bank_account
johnny,0,20
matt,10,0
abraham,100,100000
mary,15,15
linda,130,100000
</code></pre></div></div> <p>And here is how it is validated and parsed:</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">pydantic</span> <span class="kn">import</span> <span class="n">BaseModel</span>
<span class="kn">from</span> <span class="nn">pydantic</span> <span class="kn">import</span> <span class="n">Field</span> 
<span class="kn">from</span> <span class="nn">pydantic</span> <span class="kn">import</span> <span class="n">field_validator</span>
<span class="kn">from</span> <span class="nn">pydantic</span> <span class="kn">import</span> <span class="n">ValidationInfo</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">List</span>
<span class="kn">import</span> <span class="nn">csv</span>

<span class="n">FILE_NAME</span> <span class="o">=</span> <span class="s">'test.csv'</span>

<span class="k">class</span> <span class="nc">DataModel</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">min_length</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">max_length</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
    <span class="n">age</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">ge</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">le</span><span class="o">=</span><span class="mi">120</span><span class="p">)</span>
    <span class="n">bank_account</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">ge</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    
    <span class="o">@</span><span class="n">field_validator</span><span class="p">(</span><span class="s">'name'</span><span class="p">)</span>
    <span class="o">@</span><span class="nb">classmethod</span>
    <span class="k">def</span> <span class="nf">validate_name</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">v</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">info</span><span class="p">:</span> <span class="n">ValidationInfo</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">).</span><span class="n">capitalize</span><span class="p">()</span>

<span class="k">class</span> <span class="nc">ValidatedModels</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
    <span class="n">validated</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">DataModel</span><span class="p">]</span>

<span class="n">validated_rows</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">FILE_NAME</span><span class="p">,</span> <span class="s">'r'</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">reader</span> <span class="o">=</span> <span class="n">csv</span><span class="p">.</span><span class="n">DictReader</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s">','</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">reader</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">validated_rows</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">DataModel</span><span class="p">(</span><span class="o">**</span><span class="n">row</span><span class="p">))</span>
        <span class="k">except</span> <span class="n">ValidationError</span> <span class="k">as</span> <span class="n">ve</span><span class="p">:</span>
            <span class="c1"># print out error
</span>            <span class="c1"># disregard the record
</span>            <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">'</span><span class="si">{</span><span class="n">ve</span><span class="o">=</span><span class="si">}</span><span class="s">'</span><span class="p">)</span>

<span class="n">validated_rows</span>

<span class="o">&gt;</span> <span class="p">[</span><span class="n">DataModel</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">'Matt'</span><span class="p">,</span> <span class="n">age</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">bank_account</span><span class="o">=</span><span class="mf">0.0</span><span class="p">),</span>
 <span class="n">DataModel</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">'Abraham'</span><span class="p">,</span> <span class="n">age</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">bank_account</span><span class="o">=</span><span class="mf">100000.0</span><span class="p">),</span>
 <span class="n">DataModel</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">'Mary'</span><span class="p">,</span> <span class="n">age</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">bank_account</span><span class="o">=</span><span class="mf">15.0</span><span class="p">)]</span>

<span class="n">validated</span> <span class="o">=</span> <span class="n">ValidatedModels</span><span class="p">(</span><span class="n">validated</span><span class="o">=</span><span class="n">validated_rows</span><span class="p">)</span>

<span class="n">validated</span><span class="p">.</span><span class="n">model_dump</span><span class="p">()</span>

<span class="o">&gt;</span> <span class="p">{</span><span class="s">'validated'</span><span class="p">:</span> <span class="p">[{</span><span class="s">'name'</span><span class="p">:</span> <span class="s">'Matt'</span><span class="p">,</span> <span class="s">'age'</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span> <span class="s">'bank_account'</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">},</span>
  <span class="p">{</span><span class="s">'name'</span><span class="p">:</span> <span class="s">'Abraham'</span><span class="p">,</span> <span class="s">'age'</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span> <span class="s">'bank_account'</span><span class="p">:</span> <span class="mf">100000.0</span><span class="p">},</span>
  <span class="p">{</span><span class="s">'name'</span><span class="p">:</span> <span class="s">'Mary'</span><span class="p">,</span> <span class="s">'age'</span><span class="p">:</span> <span class="mi">15</span><span class="p">,</span> <span class="s">'bank_account'</span><span class="p">:</span> <span class="mf">15.0</span><span class="p">}]}</span>
</code></pre></div></div> <h3 id="fastapi-request-validation"> <a href="#fastapi-request-validation" class="anchor-head"></a> FastAPI request validation </h3> <p>FastAPI is already integrated with Pydantic, so this one is going to be very brief. The way FastAPI handles requests is by passing them to a function that handles the route. By passing this request to a function, validation is performed automatically. Something similar to validate_call that we mentioned at the beginning of this article.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">fastapi</span> <span class="kn">import</span> <span class="n">FastAPI</span>
<span class="kn">from</span> <span class="nn">pydantic</span> <span class="kn">import</span> <span class="n">BaseModel</span><span class="p">,</span> <span class="n">HttpUrl</span>

<span class="k">class</span> <span class="nc">Request</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
    <span class="n">request_id</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">url</span><span class="p">:</span> <span class="n">HttpUrl</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">FastAPI</span><span class="p">()</span>

<span class="o">@</span><span class="n">app</span><span class="p">.</span><span class="n">post</span><span class="p">(</span><span class="s">"/search/by_url/"</span><span class="p">)</span>
<span class="k">async</span> <span class="k">def</span> <span class="nf">create_item</span><span class="p">(</span><span class="n">req</span><span class="p">:</span> <span class="n">Request</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">item</span>
</code></pre></div></div> <h1 id="conclusion"> <a href="#conclusion" class="anchor-head"></a> Conclusion </h1> <p>Pydantic is a really powerful library and has a lot of mechanisms for a multitude of different use cases and edge cases as well. Today, I explained the most basic parts of how you should use it, and I’ll provide references below for those who are not faint-hearted.</p> <p>Go and explore. I’m sure it will serve you well on different fronts.</p> <h1 id="references"> <a href="#references" class="anchor-head"></a> References </h1> <ul> <li><a href="https://docs.python.org/3/library/typing.html">Python type hinting</a></li> <li><a href="https://docs.pydantic.dev/latest/concepts/models/">Pydantic models</a></li> <li><a href="https://docs.pydantic.dev/latest/concepts/validation_decorator/">Validate call</a></li> <li><a href="https://docs.pydantic.dev/latest/concepts/fields/">Pydantic fields</a></li> <li><a href="https://docs.pydantic.dev/latest/concepts/validators/">Pydantic validators</a></li> </ul> <p>For the ones persistent enough, here is a one Dall-E generated art:</p> <p><img src="../assets/img/centaur.jpg" alt="Centaur" /></p> </div> </article> </main> <small class="post-updated-at">updated_at 24-07-2024</small> <nav class="post-nav"> <a class="post-nav-item post-nav-prev" href="/post-advanced-python-dot-operator/" > <div class="nav-arrow">Previous</div> <span class="post-title">Advanced Python: Dot operator</span> </a> </nav> <footer class="footer"> <span class="footer_item">Ilija Lazarevic &copy; 2024</span> <small class="footer_copyright"> <!-- Klisé Theme: https://github.com/piharpi/jekyll-klise --> <a href="https://github.com/piharpi/jekyll-klise" target="_blank" rel="noreferrer noopener" >klisé</a > theme on <a href="https://jekyllrb.com" target="_blank" rel="noreferrer noopener" >jekyll</a > </small> </footer> <script src="/assets/js/main.js" defer="defer"></script> </div> </body> </html>
